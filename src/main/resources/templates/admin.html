<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" integrity="sha384-zCbKRCUGaJDkqS1kPbPd7TveP5iyJE0EjAuZQTgFLD2ylzuqKfdKlfG/eSrtxUkn" crossorigin="anonymous">

    <title>Admin panel</title>

    <style>
        .form-control:-webkit-autofill {
            -webkit-box-shadow: 0 0 0 1000px #fce17c inset !important;
        }
        .logout-link:link {
            color: gray; text-decoration: none;
        }
        .logout-link:visited {
            color: gray; text-decoration: none;
        }
        .logout-link:hover {
            color: lightgray; text-decoration: none;
        }
    </style>
</head>
<body class="bg-light" style="max-width: 100%; overflow-x: hidden">

<div class="container-fluid" style="padding: 0; height: 600px">

    <div class="row bg-dark" style="padding: 15px">
        <div class="col-11" style="color: white">
            <h5><strong><span th:text="${authenticatedUser.getEmail()}"></span></strong> <span>with roles: </span> <span style="display: inline-block; margin-right: 5px" th:each="role : ${authenticatedUser.getRoles()}" th:text="${role}"/></h5>
        </div>

        <div class="col-1 text-right">
            <a th:href="@{/logout}" class="logout-link">Logout</a>
        </div>
    </div>

    <div class="row" style="height: 100%">

        <div class="list-group col-2 bg-white" style="padding: 15px 0 0 15px">
            <a class="list-group-item list-group-item-action active" aria-current="true" style="border: none">
                Admin
            </a>
            <a th:href="@{/user}" class="list-group-item list-group-item-action" style="border: none; color: blue">User</a>
        </div>

        <div class="col-10 bg-light" style="padding: 15px 50px 0 40px">

            <div style="padding: 10px 10px 10px 0"><h1>Admin panel</h1></div>

            <ul class="nav nav-tabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#all_users" role="tab" data-toggle="tab">Users table</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#new_user" role="tab" data-toggle="tab">New User</a>
                </li>
            </ul>

            <div class="tab-content">

                <div class="tab-pane active" id="all_users">

                    <div class="bg-white" style="border: 1px solid lightgray">

                        <div class="bg-light" style="padding: 10px; border-bottom: 1px solid lightgray">
                            <h4>All users</h4>
                        </div>

                        <div style="padding: 20px">
                            <table class="table table-striped bg-white">
                                <thead>
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">First Name</th>
                                    <th scope="col">Last Name</th>
                                    <th scope="col">Age</th>
                                    <th scope="col">Email</th>
                                    <th scope="col">Role</th>
                                    <th scope="col">Edit</th>
                                    <th scope="col">Delete</th>
                                </tr>
                                </thead>
                                <tbody id="usersTableRow">

<!--                                <tr th:each="user : ${users}">-->
<!--                                    <th scope="row" th:text="${user.getId()}"></th>-->
<!--                                    <td th:text="${user.getFirstName()}"></td>-->
<!--                                    <td th:text="${user.getLastName()}"></td>-->
<!--                                    <td th:text="${user.getAge()}"></td>-->
<!--                                    <td th:text="${user.getEmail()}"></td>-->
<!--                                    <td><span style="display: inline-block; margin-right: 5px" th:each="role : ${user.getRoles()}" th:text="${role}"/></td>-->
<!--                                    <td>-->
<!--                                        <button type="button" class="btn btn-info" data-toggle="modal" th:attr="data-target=${'#editWindow'+user.getId()}" data-row="${user}">Edit</button>-->
<!--                                    </td>-->
<!--                                    <td>-->
<!--                                        <button type="button" class="btn btn-danger" data-toggle="modal" th:attr="data-target=${'#deleteWindow'+user.getId()}" data-row="${user}">Delete</button>-->
<!--                                    </td>-->
<!--                                </tr>-->

                                </tbody>
                            </table>

                            <!-- Модальные окна редактирования -->
                            <div class="modal fade" th:each="user : ${users}" th:attr="id=${'editWindow' + user.getId()}" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="editWindowLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="editWindowLabel">Edit user</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="col-6 offset-3 text-center">

                                                <form th:method="POST" th:action="@{/admin}" th:object="${user}" th:attr="id=${'editForm' + user.getId()}">
                                                    <div class="form-group">
                                                        <label for="id_edit"><strong>ID</strong></strong></label>
                                                        <input type="text" class="form-control" th:value="*{id}" th:name="id" id="id_edit" readonly>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="first_name_edit"><strong>First name</strong></strong></label>
                                                        <input type="text" class="form-control" th:value="*{firstName}" th:name="firstName" id="first_name_edit">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="last_name_edit"><strong>Last name</strong></label>
                                                        <input type="text" class="form-control" th:value="*{lastName}" th:name="lastName" id="last_name_edit">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="age_edit"><strong>Age</strong></label>
                                                        <input type="number" min="0" class="form-control" th:value="*{age}" th:name="age" id="age_edit">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="email_edit"><strong>Email</strong></label>
                                                        <input type="email" class="form-control" th:value="*{email}" th:name="email" id="email_edit">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="password_edit"><strong>Password</strong></label>
                                                        <input type="password" class="form-control" th:name="password" id="password_edit">
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="role_edit"><strong>Role</strong></label>
                                                        <select class="form-control" multiple="multiple" name="roleIds">
                                                            <option th:each="role : ${allRoles}" th:selected="${user.getRoles().contains(role)}" th:value="${role.id}" th:name="roles" th:text="${role}" id="role_edit"></option>
                                                        </select>
                                                    </div>
                                                </form>

                                            </div>
                                        </div>

                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                            <button type="submit" th:attr="form=${'editForm' + user.getId()}" class="btn btn-primary">Edit</button>
                                        </div>

                                    </div>
                                </div>
                            </div>

                            <!-- Модальное окно удаления -->
                            <div class="modal fade" id="deleteWindow" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="deleteWindowLabel" aria-hidden="true">
                                <div class="modal-dialog modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="deleteWindowLabel">Delete user</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <div class="modal-body">
                                            <div class="col-6 offset-3 text-center">

                                                <form>
                                                    <div class="form-group">
                                                        <label for="id_delete"><strong>ID</strong></strong></label>
                                                        <input type="text" class="form-control" id="id_delete" readonly>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="first_name_delete"><strong>First name</strong></strong></label>
                                                        <input type="text" class="form-control" id="first_name_delete" readonly>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="last_name_delete"><strong>Last name</strong></label>
                                                        <input type="text" class="form-control" id="last_name_delete" readonly>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="age_delete"><strong>Age</strong></label>
                                                        <input type="number" class="form-control" id="age_delete" readonly>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="email_delete"><strong>Email</strong></label>
                                                        <input type="email" class="form-control" id="email_delete" readonly>
                                                    </div>
                                                    <div class="form-group">
                                                        <label for="role_delete"><strong>Role</strong></label>
                                                        <select class="form-control" multiple="multiple" id="role_delete" readonly>
                                                            <option th:each="role : ${allRoles}" th:value="${role}" th:text="${role}"></option>
                                                        </select>
                                                    </div>
                                                </form>

                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
<!--                                            <form th:method="POST" th:action="@{/admin/{id}(id=${user.getId()})}">-->
                                                <button type="submit" class="btn btn-danger" id="deleteBtnModal">Delete</button>
<!--                                            </form>-->
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>

                </div>

                <div class="tab-pane" id="new_user">

                    <div class="bg-white" style="border: 1px solid lightgray">

                        <div class="bg-light" style="padding: 10px; border-bottom: 1px solid lightgray">
                            <h4>Add new user</h4>
                        </div>

                        <div class="col-3 offset-4  text-center" style="padding: 20px">

<!--                            <form th:method="POST" th:action="@{/admin}">-->
                            <form id="addNewUserForm">
                                <div class="form-group">
                                    <label for="first_name"><strong>First name</strong></strong></label>
                                    <input type="text" class="form-control" id="first_name" placeholder="First name">
                                </div>
                                <div class="form-group">
                                    <label for="last_name"><strong>Last name</strong></label>
                                    <input type="text" class="form-control" id="last_name" placeholder="Last name">
                                </div>
                                <div class="form-group">
                                    <label for="age"><strong>Age</strong></label>
                                    <input required type="number" min="0" class="form-control" id="age" placeholder="Age">
                                </div>
                                <div class="form-group">
                                    <label for="email"><strong>Email</strong></label>
                                    <input required type="email" class="form-control" id="email" placeholder="Email">
                                </div>
                                <div class="form-group">
                                    <label for="password"><strong>Password</strong></label>
                                    <input required type="password" class="form-control" id="password" placeholder="Password">
                                </div>
                                <div class="form-group">
                                    <label for="role"><strong>Role</strong></label>
                                    <select multiple required class="form-control" name="roleIds" id="role">
                                        <option th:each="role : ${allRoles}" th:value="${role.id} + '&&' + ${role.name}" th:name="roles" th:text="${role}"></option>
                                    </select>
                                </div>

                                <button type="submit" class="btn btn-success">Add new user</button>

                            </form>

                        </div>

                    </div>

                </div>

            </div>

        </div>

    </div>

</div>

<!-- Пакет jQuery и Bootstrap (включает Popper) -->
<!--<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>-->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF" crossorigin="anonymous"></script>

<script type="text/javascript" src="app.js"></script>

</body>
</html>